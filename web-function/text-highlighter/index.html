<!-- https://github.com/Perlego/texthighlighter -->
<!-- http://mir3z.github.io/texthighlighter/ -->
<!-- http://mir3z.github.io/texthighlighter/demos/simple.html -->
<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="UTF-8" />
    <title>TextHighlighter Demo | Simple Usage</title>
    <link
      href="http://fonts.googleapis.com/css?family=Open+Sans:700,400|Special+Elite"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" type="text/css" href="./reset.css" />
    <link rel="stylesheet" type="text/css" href="./styles.css" />
    <!-- 重點: TextHighlighter.prototype.doHighlight -->
    <script type="text/javascript" src="./TextHighlighter.js"></script>
  </head>
  <body>
    <div class="view">
      <div class="top"></div>

      <div class="side">
        <h2>TextHighlighter Demo</h2>
        <ul>
          <li>Select any text in the sandbox to highlight it.</li>
          <li>
            Change highlighting color:
            <div class="color-picker"></div>
          </li>
          <li>
            Remove all highlights: <button id="remove">Remove All</button>
          </li>
        </ul>
      </div>

      <div class="code shadow">
        <div class="btn-group" id="modal">
          <button style="padding: 10px">
            <h3>畫線(僅支援白色框框內的文字，上方可以選顏色)</h3>
          </button>
        </div>
        <div class="btn-group" id="removeTarget">
          <button style="padding: 10px">
            <h3>
              刪除框選(只要框選'起點'有包含螢光筆，就移除第一個區塊，否則不處理)，遇到粗體斜體區域則只處理一塊
            </h3>
          </button>
        </div>
      </div>

      <div class="card shadow">
        <div id="stamp">SANDBOX</div>
        <div id="sandbox" class="content">
          <h1>Lorem ipsum</h1>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec
            luctus malesuada sagittis. Morbi purus odio, blandit ac urna sed,
            <b>interdum pharetra</b> leo. Cras congue id est sit amet mattis.
            Sed in metus et orci eleifend commodo. Phasellus at odio imperdiet,
            efficitur augue in, pulvinar sapien. Pellentesque leo nulla, porta
            non lectus eu, ullamcorper semper est. Nunc <i>convallis</i> risus
            vel mauris accumsan, in rutrum odio sodales. Vestibulum
            <b>ante ipsum</b> primis in faucibus orci luctus et ultrices posuere
            cubilia Curae; Sed at tempus mauris. Fusce blandit felis sit amet
            magna lacinia blandit.
          </p>
          <p>
            Maecenas faucibus hendrerit lectus, in auctor felis tristique at.
            Pellentesque a felis ut nibh malesuada auctor. Ut
            <b>egestas elit</b> ac ultrices ullamcorper. Pellentesque enim est,
            varius ultrices velit eget, consectetur aliquam tortor. Aliquam sit
            amet nibh id tellus sollicitudin faucibus. Nunc euismod augue
            tempus, ornare justo interdum, consectetur lacus. Pellentesque a
            molestie tellus, eget convallis lectus.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed vitae
            nunc sed risus blandit convallis id id risus. Morbi tortor metus,
            imperdiet sed ipsum quis, condimentum mattis tellus. Fusce orci
            nisi, ultricies vel hendrerit id, egestas id turpis. Proin cursus
            diam tortor, sed ullamcorper eros commodo vitae. Aenean et maximus
            sapien. Nam felis velit, ullamcorper eu turpis ut, hendrerit
            accumsan augue. Nulla et purus sem. Ut at hendrerit purus.
            <b>Phasellus mollis commodo</b> ante eu mollis. In nec dui vel
            mauris lacinia vulputate id nec turpis. Aliquam vestibulum, elit sit
            amet fringilla malesuada, quam nunc eleifend nunc, id iaculis est
            neque pretium libero.
          </p>

          <table>
            <thead>
              <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>John</td>
                <td>Lucius</td>
                <td>j.lu@mail.com</td>
              </tr>
              <tr>
                <td>Nikolai</td>
                <td>Bodrov</td>
                <td>niko.b@mail.com</td>
              </tr>
              <tr>
                <td>Steve</td>
                <td>Suzy</td>
                <td>s.suzy@mail.com</td>
              </tr>
              <tr>
                <td>Alex</td>
                <td>Stirling</td>
                <td>alexs@mail.com</td>
              </tr>
            </tbody>
          </table>

          <p>
            Donec sollicitudin commodo risus in consequat. Curabitur ultricies
            sagittis mi, a dapibus nunc mollis sed. Sed ut pretium leo, quis
            vehicula diam. Proin nisi metus, elementum ut mi porttitor, cursus
            egestas sem. Interdum et malesuada fames ac ante ipsum primis in
            faucibus. Phasellus mattis ipsum ut enim efficitur mollis. Vivamus
            id mollis lectus.
          </p>

          <form action="#" method="post">
            <div>
              <label for="first-name">First name:</label>
              <input
                type="text"
                id="first-name"
                placeholder="Enter your first name"
              />
            </div>

            <div>
              <label for="last-name">Last name:</label>
              <input
                type="text"
                id="last-name"
                placeholder="Enter your last name"
              />
            </div>

            <div>
              <label for="gender">Gender:</label>
              <select id="gender">
                <option>Male</option>
                <option>Female</option>
              </select>
            </div>

            <input type="submit" disabled="true" value="Send" />
          </form>

          <p>
            In est tortor, tincidunt vitae elit at, ultricies tincidunt magna.
            Aenean suscipit ante sapien, quis sagittis felis efficitur feugiat.
            In arcu elit, hendrerit vel varius eget, elementum vitae lectus.
            Phasellus ut purus commodo ante iaculis molestie. Integer turpis
            felis, pellentesque eu dignissim vel, sodales vel metus. Aliquam
            tempus lorem odio. Sed purus arcu, auctor eget sodales ac, venenatis
            ac velit. Praesent a quam at purus varius accumsan sit amet quis
            magna. Praesent efficitur velit quis mi posuere, ut egestas elit
            egestas. Etiam vulputate lacus in posuere suscipit. Fusce molestie
            sem ipsum. Phasellus consectetur, purus quis auctor laoreet, elit
            nisi aliquet metus, et placerat nunc tellus ac massa. Praesent
            cursus ornare nulla eu ultrices.
          </p>
        </div>
        <pre>
          <span class="highlighted" data-timestamp="1696227122010" style="background-color: rgb(255, 255, 123);" data-highlighted="true">dolor </span>
        </pre>
      </div>
    </div>
    <div id="footer">
      Copyright &copy; 2019 by Perlego Limited. All Rights Reserved. <br />
      hltr.setColor(color); <br />
      hltr.removeHighlights();
    </div>
    <script type="text/javascript">
      (function () {
        var removeBtn = document.getElementById("remove");
        // 移除按鈕綁定
        removeBtn.addEventListener("click", function () {
          hltr.removeHighlights();
        });

        // 框選區域
        var sandbox = document.getElementById("sandbox");

        var hltr = new TextHighlighter(sandbox);
        // color='#8BC34A'
        hltr.setColor("#8BC34A");
        console.log(hltr);

        // 指定移除
        const highlightedSpans = document.querySelectorAll(
          'span.highlighted[data-highlighted="true"]'
        );
        if (highlightedSpans[0]) {
          hltr.removeHighlights(highlightedSpans[0]);
        }

        // 移除框選的元素之螢光筆
        var removeTarget = document.getElementById("removeTarget");
        removeTarget.addEventListener("click", function () {
          const SelectedNode = getSelectedNode();
          if (SelectedNode?.tagName?.toLowerCase() === "span") {
            hltr.removeHighlights(SelectedNode);
          }
        });

        // 取得框選區域得元素
        function getSelectedNode() {
          if (document.selection)
            return document.selection.createRange().parentElement();
          else {
            var selection = window.getSelection();
            if (selection.rangeCount > 0)
              return selection.getRangeAt(0).startContainer.parentNode;
          }
        }

        // 取消user選取
        function removeSelection() {
          const selection = window.getSelection();
          const range = selection.getRangeAt(0);
          if (selection && range) {
            selection.removeRange(range);
          }
        }
      })();
    </script>
  </body>
</html>
