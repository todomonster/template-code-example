<!--
src = https://github.com/ahh666/code-essays/blob/main/draggable/index.js
fix power by gpt
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>拖拽切换元素</title>
  </head>
  <style>
    #drag-box {
      background: #f3f5f6;
      height: 100vh;
      padding: 50px;
    }
    #drag-box > div {
      color: #333;
      width: 300px;
      height: 40px;
      line-height: 40px;
      background-color: #fff;
      margin-bottom: 6px;
      border: 1px solid darkcyan;
    }
  </style>
  <body>
    <div id="drag-box">
      <div draggable="true">唐僧</div>
      <div draggable="true">孙猴子</div>
      <div draggable="true">八戒</div>
      <div draggable="true">沙和尚</div>
    </div>
  </body>
  <script>
    function dragHandler() {
      const dragBox = document.getElementById("drag-box");
      let draggedNode = null;
      let draggedNodeBg = null;
      let dragEnterNodeBg = null;

      dragBox.addEventListener("dragstart", (e) => {
        if (e.target.matches('div[draggable="true"]')) {
          draggedNode = e.target;
          draggedNodeBg = getComputedStyle(draggedNode).background;
          draggedNode.style.background = "#bbb";
        }
      });

      dragBox.addEventListener("dragover", (e) => {
        e.preventDefault();
      });

      dragBox.addEventListener("drop", (e) => {
        e.preventDefault();
        if (dragEnterNodeBg) {
          e.target.style.background = dragEnterNodeBg;
        }
        if (
          draggedNode &&
          draggedNode !== e.target &&
          draggedNode.parentElement === dragBox && // 檢查被拖拽節點的父節點是不是 dragBox
          e.target.parentElement === dragBox // 檢查目標節點的父節點是不是 dragBox
        ) {
          const temp = document.createElement("div");
          dragBox.replaceChild(temp, e.target);
          dragBox.replaceChild(e.target, draggedNode);
          dragBox.replaceChild(draggedNode, temp);
        }
      });

      dragBox.addEventListener("dragend", (e) => {
        if (e.target.matches('div[draggable="true"]')) {
          e.target.style.background = draggedNodeBg;
        }
      });

      dragBox.addEventListener("dragenter", (e) => {
        if (
          e.target.matches('div[draggable="true"]') &&
          e.target !== draggedNode
        ) {
          dragEnterNodeBg = getComputedStyle(e.target).background;
          e.target.style.background = "darkcyan";
        }
      });

      dragBox.addEventListener("dragleave", (e) => {
        if (
          e.target.matches('div[draggable="true"]') &&
          dragEnterNodeBg &&
          e.target !== draggedNode
        ) {
          e.target.style.background = dragEnterNodeBg;
        }
      });
    }

    dragHandler();
  </script>
</html>
